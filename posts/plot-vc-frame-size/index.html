<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Video Frame Sizes Visualization - Max Sharabayko Blog</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/blog/css/style.css><link rel=stylesheet href=/blog/css/custom.css><link rel="shortcut icon" href=/blog/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/blog/ title="Max Sharabayko Blog" rel=home><div class="logo__item logo__text"><div class=logo__title>Max Sharabayko Blog</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/blog/><i class='fa fa-heart'></i>
<span class=menu__text>blog</span></a></li><li class=menu__item><a class=menu__link href=/blog/papers/><span class=menu__text>Publications</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Video Frame Sizes Visualization</h1><p class=post__lead>Visualize Compressed Video</p><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2024-10-30T00:00:00Z>October 30, 2024</time></div></div></header><div class="content post__content clearfix"><p>In this tutorial, we&rsquo;ll walk through how to use Python and Bokeh to visualize video frame sizes (H.264/AVC, H.265/HEVC, etc.)
and calculate moving average bitrate values from an MPEG TS file.
We&rsquo;ll use <code>ffprobe</code> to extract frame information and <code>pandas</code> for data manipulation. Finally, we&rsquo;ll create interactive plots with Bokeh.</p><p>Here is what we&rsquo;ll have as the result.</p><figure><img src=/blog/posts/plot-vc-frame-size/plot-in-action.gif alt="Frame Sizes and Types Bar Chart With MAvg Bitrate Values"><figcaption><p>Frame Sizes and Types Bar Chart With MAvg Bitrate Values</p></figcaption></figure><p>❗ The final python script with <code>click</code> for CLI parsing can be found here: <a href=https://gist.github.com/maxsharabayko/6b21f816fba267c390e8ff90c12f25b9>[gist]</a>.</p><h2 id=prerequisites>Prerequisites</h2><p>Make sure you have the following installed:</p><ul><li>Python 3.x</li><li><code>ffprobe</code> (part of the FFmpeg suite)</li><li><code>pandas</code> library</li><li><code>bokeh</code> library</li></ul><p>You can install the required Python libraries using <code>pip</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pip install pandas bokeh
</span></span></code></pre></div><h2 id=step-1-extract-frame-information--with-ffprobe>Step 1. Extract Frame Information with FFprobe</h2><p>First, use FFprobe to extract frame sizes and types from your MPEG TS file.
FFprobe is a perfect tool for this: it is free, well maintained and supports a wide range of codecs.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ffprobe -v error -select_streams v:0 -show_entries frame<span style=color:#f92672>=</span>pkt_pos,pkt_size,pict_type -of csv<span style=color:#f92672>=</span>p<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> input_file.ts &gt; frame_info.csv
</span></span></code></pre></div><p>Replace <code>input_file.ts</code> with the path to your MPEG TS file. This command will output the frame position (<code>pkt_pos</code>),
size (<code>pkt_size</code>) and frame type (<code>pict_type</code>) in CSV format using FFprobe&rsquo;s <a href=https://ffmpeg.org/ffprobe.html#Writers>CSV writer</a>.</p><p>The file produced will have frame position, frame size, picture type and two empty columns (for some reason).
Note that frames are arranged in a display order. The frame position column can be used to rearrange data in a stream order.</p><pre tabindex=0><code class=language-csv data-lang=csv>222968,46380,I,,
288768,9202,B,,
298356,5113,B,,
303620,3164,B,,
270908,17308,P,,
</code></pre><h2 id=step-2-load-and-process-the-csv-data>Step 2: Load and Process the CSV Data</h2><p>Next, we’ll load the CSV data into a pandas DataFrame and process it to calculate moving averages and rolling average bitrates.</p><h3 id=21-load-csv-data>2.1 Load CSV Data</h3><p>Let&rsquo;s create a function to load the CSV data and drop two empty columns in a CSV file produced by FFprobe.
Additionally the data frame is sorted based on <code>frame_pos</code> column to use a stream order.
The function will return a pandas DataFrame.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load_csv</span>(file_path):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Load CSV file into a DataFrame and drop empty columns.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(file_path, header<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, names<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;frame_pos&#39;</span>, <span style=color:#e6db74>&#39;frame_size&#39;</span>, <span style=color:#e6db74>&#39;pict_type&#39;</span>, <span style=color:#e6db74>&#39;empty1&#39;</span>, <span style=color:#e6db74>&#39;empty2&#39;</span>])
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>drop(columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;empty1&#39;</span>, <span style=color:#e6db74>&#39;empty2&#39;</span>])
</span></span><span style=display:flex><span>    <span style=color:#75715e># Convert display order to stream order. Drop the old index to use the new order.</span>
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;frame_pos&#39;</span>)<span style=color:#f92672>.</span>reset_index(drop<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><h3 id=22-calculate-bitrate>2.2. Calculate Bitrate</h3><p>Let&rsquo;s add a function to calculate video bitrate values (moving average) using 3 seconds, 1 second and 100 milliseconds rolling window.
An additional argument <code>fps</code> (frames per second) is required.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_bitrates</span>(df, fps):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Calculate 3s, 1s and 100 ms rolling average bitrate values.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    fps_div_10 <span style=color:#f92672>=</span> fps <span style=color:#f92672>//</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Calculate the rolling sum of &#39;frame_size&#39; values converted from bytes to megabits.</span>
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;mbps_mavg_1s&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;frame_size&#39;</span>]<span style=color:#f92672>.</span>rolling(window<span style=color:#f92672>=</span>fps)<span style=color:#f92672>.</span>sum() <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>1e6</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Similar for 3s moving average.</span>
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;mbps_mavg_3s&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;frame_size&#39;</span>]<span style=color:#f92672>.</span>rolling(window<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span><span style=color:#f92672>*</span>fps)<span style=color:#f92672>.</span>sum() <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>1e6</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># The same but using 100 millisecond intervals.</span>
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;mbps_mavg_100ms&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;frame_size&#39;</span>]<span style=color:#f92672>.</span>rolling(window<span style=color:#f92672>=</span>fps_div_10)<span style=color:#f92672>.</span>sum() <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>1e6</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>/</span> (fps_div_10 <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span>) <span style=color:#f92672>*</span> fps
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>The first missing MAVG values can be calculated using an expanding sum or using the existing data to extrapolate the bitrate, but it is optional.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Calculate the first missing values of the &#39;mbps_mavg_1s&#39;,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># place them into df[&#39;mbps_mavg_1s&#39;]</span>
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>loc[:fps, <span style=color:#e6db74>&#39;mbps_mavg_1s&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;frame_size&#39;</span>]<span style=color:#f92672>.</span>expanding(min_periods<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>sum()<span style=color:#f92672>.</span>iloc[:fps] <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>1e6</span>
</span></span></code></pre></div><h3 id=23-add-kilobyte-frame-sizes>2.3. Add Kilobyte Frame Sizes</h3><p>Let&rsquo;s convert frame sizes to kilobytes to have a nicer plot.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_kbyte_frame_sizes</span>(df):
</span></span><span style=display:flex><span>    <span style=color:#75715e># Convert to kilobytes</span>
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;frame_size_kBytes&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;frame_size&#39;</span>] <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><h3 id=24-add-color-column>2.4. Add Color Column</h3><p>For further visualization let&rsquo;s use a color to represent a certain frame type:</p><ul><li>Red for an I frame,</li><li>Blue for a P frame,</li><li>Green for a B frame.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_color_column</span>(df):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Add a color column based on pict_type.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    colors <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;I&#39;</span>: <span style=color:#e6db74>&#39;red&#39;</span>, <span style=color:#e6db74>&#39;P&#39;</span>: <span style=color:#e6db74>&#39;blue&#39;</span>, <span style=color:#e6db74>&#39;B&#39;</span>: <span style=color:#e6db74>&#39;green&#39;</span>}
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;color&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;pict_type&#39;</span>]<span style=color:#f92672>.</span>map(colors)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><h2 id=step-3-create-interactive-plots-with-bokeh>Step 3: Create Interactive Plots with Bokeh</h2><p>Let&rsquo;s visualize the data using <a href=https://bokeh.org/>Bokeh</a> – a Python library for creating interactive visualizations.</p><p>The following imports would be required.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> bokeh.plotting <span style=color:#f92672>import</span> figure, show, output_file
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bokeh.io <span style=color:#f92672>import</span> output_notebook
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bokeh.transform <span style=color:#f92672>import</span> factor_cmap
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bokeh.models <span style=color:#f92672>import</span> Legend, LegendItem
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bokeh.layouts <span style=color:#f92672>import</span> column
</span></span></code></pre></div><p>Let&rsquo;s create a color-coded bar chart for frame sizes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_bar_chart</span>(df):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Create a bar chart for frame sizes with color legend.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create the bar chart figure.</span>
</span></span><span style=display:flex><span>    p1 <span style=color:#f92672>=</span> figure(x_axis_label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Frame Index&#39;</span>, y_axis_label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Frame Size, kbytes&#39;</span>, title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Frame Sizes by Type&#39;</span>, width<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>, height<span style=color:#f92672>=</span><span style=color:#ae81ff>400</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Add bars to the bar chart figure.</span>
</span></span><span style=display:flex><span>    bars <span style=color:#f92672>=</span> p1<span style=color:#f92672>.</span>vbar(x<span style=color:#f92672>=</span>df<span style=color:#f92672>.</span>index, top<span style=color:#f92672>=</span>df[<span style=color:#e6db74>&#39;frame_size_kBytes&#39;</span>], width<span style=color:#f92672>=</span><span style=color:#ae81ff>0.9</span>, color<span style=color:#f92672>=</span>df[<span style=color:#e6db74>&#39;color&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Find the first index of each pict_type</span>
</span></span><span style=display:flex><span>    i_index <span style=color:#f92672>=</span> df[df[<span style=color:#e6db74>&#39;pict_type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;I&#39;</span>]<span style=color:#f92672>.</span>index[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    p_index <span style=color:#f92672>=</span> df[df[<span style=color:#e6db74>&#39;pict_type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;P&#39;</span>]<span style=color:#f92672>.</span>index[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    b_index <span style=color:#f92672>=</span> df[df[<span style=color:#e6db74>&#39;pict_type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;B&#39;</span>]<span style=color:#f92672>.</span>index[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Add a legend to describe color meaning.</span>
</span></span><span style=display:flex><span>    legend_items <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        LegendItem(label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;I Frame&#34;</span>, renderers<span style=color:#f92672>=</span>[bars], index<span style=color:#f92672>=</span>i_index),
</span></span><span style=display:flex><span>        LegendItem(label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;P Frame&#34;</span>, renderers<span style=color:#f92672>=</span>[bars], index<span style=color:#f92672>=</span>p_index),
</span></span><span style=display:flex><span>        LegendItem(label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;B Frame&#34;</span>, renderers<span style=color:#f92672>=</span>[bars], index<span style=color:#f92672>=</span>b_index)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    legend1 <span style=color:#f92672>=</span> Legend(items<span style=color:#f92672>=</span>legend_items, location<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;top_right&#34;</span>)
</span></span><span style=display:flex><span>    p1<span style=color:#f92672>.</span>add_layout(legend1)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> p1
</span></span></code></pre></div><p>Also let&rsquo;s create a plot for bitrate values. It will be placed right below the bar chart. The x axis of both plots will be synchronized.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_bitrates_plot</span>(df, x_range):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Create a plot for bitrate values with toggleable lines.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create the moving average plot figure</span>
</span></span><span style=display:flex><span>    p2 <span style=color:#f92672>=</span> figure(x_axis_label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Frame Index&#39;</span>, y_axis_label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Mbps&#39;</span>, title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Bitrate&#39;</span>, width<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>, height<span style=color:#f92672>=</span><span style=color:#ae81ff>400</span>, x_range<span style=color:#f92672>=</span>x_range)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Add the Mbps moving average line to the moving average plot figure</span>
</span></span><span style=display:flex><span>    line1 <span style=color:#f92672>=</span> p2<span style=color:#f92672>.</span>line(df<span style=color:#f92672>.</span>index, df[<span style=color:#e6db74>&#39;mbps_mavg_3s&#39;</span>], line_width<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;black&#39;</span>, legend_label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;MAvg Bitrate (3s), Mbps&#39;</span>)
</span></span><span style=display:flex><span>    line2 <span style=color:#f92672>=</span> p2<span style=color:#f92672>.</span>line(df<span style=color:#f92672>.</span>index, df[<span style=color:#e6db74>&#39;mbps_mavg_1s&#39;</span>], line_width<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;green&#39;</span>, legend_label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;MAvg Bitrate (1s), Mbps&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Add the rolling average bitrate line to the moving average plot figure</span>
</span></span><span style=display:flex><span>    line3 <span style=color:#f92672>=</span> p2<span style=color:#f92672>.</span>line(df<span style=color:#f92672>.</span>index, df[<span style=color:#e6db74>&#39;mbps_mavg_100ms&#39;</span>], line_width<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;blue&#39;</span>, legend_label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;MAvg Bitrate (100ms), Mbps&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    p2<span style=color:#f92672>.</span>legend<span style=color:#f92672>.</span>click_policy <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hide&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> p2
</span></span></code></pre></div><p>Now a function to create a plot of frame sizes and bitrate values.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>plot_frame_sizes</span>(df):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;A function to plot frame sizes using a bar chart and bitrate values right below.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    p1 <span style=color:#f92672>=</span> create_bar_chart(df)
</span></span><span style=display:flex><span>    p2 <span style=color:#f92672>=</span> create_bitrates_plot(df, x_range<span style=color:#f92672>=</span>p1<span style=color:#f92672>.</span>x_range)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Uncomment if you want to use it in a notebook.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#output_notebook()</span>
</span></span><span style=display:flex><span>    show(column(p1, p2))
</span></span></code></pre></div><h2 id=result>Result</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>plot_frame_sizes_from_csv</span>(file_path):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;A function to plot frame sizes and bitrate values from a CSV file.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> load_csv(file_path)
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> calculate_bitrates(df)
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> calculate_kbyte_frame_sizes(df)
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> add_color_column(df)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    plot_frame_sizes(df)
</span></span></code></pre></div><p>As the result the following interactive plot will be built:</p><figure><img src=/blog/posts/plot-vc-frame-size/plot-in-action.gif alt="Frame Sizes and Types Bar Chart With MAvg Bitrate Values"><figcaption><p>Frame Sizes and Types Bar Chart With MAvg Bitrate Values</p></figcaption></figure><p>❗ The final python script with <code>click</code> for CLI parsing can be found here: <a href=https://gist.github.com/maxsharabayko/6b21f816fba267c390e8ff90c12f25b9>[gist]</a>.</p><h2 id=conclusion>Conclusion</h2><p>By following these steps, you can visualize H.264/AVC, H.265/HEVC etc. frame sizes and calculate moving average bitrate values from an MPEG TS file.
The interactive plots created with Bokeh allow you to explore the data and gain insights into the frame sizes and bitrates.</p><p>Feel free to modify the code to suit your needs and experiment with different datasets. Happy coding!</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/blog/tags/video-compression/ rel=tag>Video Compression</a></li><li class=tags__item><a class="tags__link btn" href=/blog/tags/ffprobe/ rel=tag>ffprobe</a></li><li class=tags__item><a class="tags__link btn" href=/blog/tags/python/ rel=tag>Python</a></li></ul></div></footer></article></main><section class=comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-maxsharabayko-github-io-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><input class=widget-search__field type=search placeholder=Search… name=q aria-label=Search…>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=https://maxsharabayko.github.io/blog/></form></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/blog/posts/plot-vc-frame-size/>Video Frame Sizes Visualization</a></li><li class=widget__item><a class=widget__link href=/blog/posts/bd-rate/>Bjontegaard Delta-Rate Metric</a></li><li class=widget__item><a class=widget__link href=/blog/posts/srt-4g-streaming-2022/>Examining SRT Streaming over 4G Networks</a></li><li class=widget__item><a class=widget__link href=/blog/posts/nextgen-codecs-2013/>Next Generation Video Codecs: HEVC, VP9, Daala (2013)</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/blog/tags/ffprobe/ title=Ffprobe>Ffprobe</a>
<a class="widget-taglist__link widget__link btn" href=/blog/tags/psnr/ title=PSNR>PSNR</a>
<a class="widget-taglist__link widget__link btn" href=/blog/tags/python/ title=Python>Python</a>
<a class="widget-taglist__link widget__link btn" href=/blog/tags/quality-metrics/ title="Quality Metrics">Quality Metrics</a>
<a class="widget-taglist__link widget__link btn" href=/blog/tags/srt/ title=SRT>SRT</a>
<a class="widget-taglist__link widget__link btn" href=/blog/tags/video-compression/ title="Video Compression">Video Compression</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=LinkedIn rel="noopener noreferrer" href=https://linkedin.com/in/maxim-sharabayko target=_blank><svg class="widget-social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg>
<span>LinkedIn</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/maxsharabayko target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg>
<span>GitHub</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2024 Maxim Sharabayko.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/blog/js/menu.js></script></body></html>